<div class="container-fluid">
    <h1>nines</h1>
    <div id="content">
        <h2>Response Stats</h2>

        <!---------------------------------------------------------------------
         Form for Adding URL Groups
        ---------------------------------------------------------------------->
        <div id="manageUrlGroups" ng-controller="uiMainUrlGroupsCtrl">
            <div class="btn-group" role="group" aria-label="actions for managing URL Groups">
                <button type="button" class="btn btn-large btn-primary"
                        ng-click="showAddUrlGroupForm()">
                    Add URL Group
                </button>
            </div>

            <div id="add-url-group-form" ng-show="showFormAddUrlGroup">
                <h3>Add new URL Group</h3>
                <form name="add-url-group">
                    <div class="form-group">
                        <label for="url-group-name">URL Group Name</label>
                        <input type="text" class="form-control" id="url-group-name"
                               ng-model="newUrlGroup.name" name="url-group-name">
                    </div>
                    <div class="form-alert">
                        <alert ng-show="addUrlGroupFormMessage">{{addUrlGroupFormMessage}}</alert>
                    </div>
                    <button type="submit" class="btn btn-large btn-primary"
                            ng-click="addUrlGroup(newUrlGroup)">
                        Add
                    </button>
                    <button class="btn btn-large btn-default" ng-click="hideAddUrlGroupForm()">
                        Cancel
                    </button>
                </form>
            </div>
        </div>

        <!---------------------------------------------------------------------
         Main Display of Groups, URLs, and Ratings
        ---------------------------------------------------------------------->
        <div ng-repeat="urlgroup in urlgroups" ng-controller="uiMainUrlsCtrl">
            <table class="table table-striped table-condensed table-responsive">
                <h3>{{urlgroup.name}}</h3>
                <thead>
                    <th class="col-md-1" ng-show="showIconsRemoveUrl === urlgroup._id">Remove</th>
                    <th class="col-md-2">Name</th>
                    <th class="col-md-2">URL</th>
                    <th class="col-md-1" ng-repeat="(statusCode, count) in urlgroup.responses">
                        {{statusCode}}
                    </th>
                    <th class="col-md-3" colspan="{{numDigits + 1}}">Availability Rating (%)</th>
                </thead>
                <tbody>
                    <tr ng-repeat="url in urls |
                                   filter : { urlgroup_id: urlgroup._id } |
                                   orderBy: 'name'">
                        <td ng-show="showIconsRemoveUrl === urlgroup._id">
                            <a ng-click="prepRemoveUrl(url._id, url.name)"
                               data-toggle="modal"
                               data-target="#confirmationModal">
                                X
                            </a>
                        </td>
                        <td>{{url.name}}</td>
                        <td><a href="http://{{url.host}}{{url.path}}" target="_blank">
                            {{url.host}}{{url.path}}</a>
                        </td>

                        <td ng-repeat="stat in getUrlStats(urlgroup.responses, url.responses)">
                            {{stat}}
                        </td>
                        <td ng-repeat="(statNum, rating) in getAvailRating(urlgroup.responses, url.responses)">
                            <span ng-show="rating === '.'">{{rating}}</span>
                            <span ng-hide="rating === '.'"
                                  class="label {{getStatMarkup(statNum, rating)}}">
                                {{rating}}
                            </span>
                        </td>

                    </tr>
                    <tr class="url-group-total-row">
                        <td ng-show="showIconsRemoveUrl === urlgroup._id"></td>
                        <td colspan="2">
                            Group Total:
                        </td>
                        <td ng-repeat="stat in getUrlStats(urlgroup.responses)">
                            {{stat}}
                        </td>
                        <td ng-repeat="(statNum, rating) in getAvailRating(urlgroup.responses)">
                            <span ng-show="rating === '.'">{{rating}}</span>
                            <span ng-hide="rating === '.'"
                                  class="label {{getStatMarkup(statNum, rating)}}">
                                {{rating}}
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-----------------------------------------------------------------
             Buttons for Adding/Removing URLs and Form for Adding URLs
            ------------------------------------------------------------------>
            <div id="manageUrls">
                <div class="btn-toolbar" role="group" aria-label="actions for managing URLs">
                    <button type="button" class="btn btn-primary"
                            ng-hide="showIconsRemoveUrl === urlgroup._id"
                            ng-click="showAddUrlForm(urlgroup._id)">
                        Add URL
                    </button>
                    <button type="button" class="btn btn-danger"
                            ng-hide="showIconsRemoveUrl === urlgroup._id"
                            ng-click="showRemoveUrlIcons(urlgroup._id)">
                        Remove URLs
                    </button>
                    <button type="button" class="btn btn-success"
                            ng-show="showIconsRemoveUrl === urlgroup._id"
                            ng-click="showRemoveUrlIcons(urlgroup._id)">
                        Done
                    </button>
                </div>
                <div id="add-url-form" ng-show="showFormAddUrl === urlgroup._id">
                    <h3>Add new URL</h3>
                    <form name="add-url">
                        <div class="form-group">
                            <label for="url-name">URL Name</label>
                            <input type="text" class="form-control" id="url-name"
                                   ng-model="newUrl.name" name="url-name">
                            <label for="url-host">URL Host</label>
                            <input type="text" class="form-control" id="url-host"
                                   ng-model="newUrl.host" name="url-host">
                            <label for="url-path">URL Path</label>
                            <input type="text" class="form-control" id="url-path"
                                   ng-model="newUrl.path" name="url-path">
                            <label for="url-protocol-choice-buttons">Protocol</label>
                            <div id="url-protocol-choice-buttons">
                                <label class="radio-inline">
                                    <input type="radio" name="urlProtocolOptions"
                                           id="urlProtocolHttp" value="http"
                                           ng-model="newUrl.protocol">
                                    HTTP
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="urlProtocolOptions"
                                           id="urlProtocolHttps" value="https"
                                           ng-model="newUrl.protocol">
                                    HTTPS
                                </label>
                            </div>
                        </div>
                        <div class="form-alert">
                            <alert ng-show="addUrlFormMessage">{{addUrlFormMessage}}</alert>
                        </div>
                        <button type="submit" class="btn btn-large btn-primary"
                                ng-click="addUrl(newUrl, urlgroup._id)">
                            Add
                        </button>
                        <button class="btn btn-large btn-default" ng-click="hideAddUrlForm()">
                            Cancel
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation modals -->
    <div class="modal fade" id="confirmationModal" tabindex="-1" role="dialog"
         aria-labelledby="confirmationModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="confirmationModalLabel">
                        {{remUrlName}} - remove confirmation
                    </h4>
                </div>
                <div class="modal-body">
                    <p>
                        Click 'Remove' to remove the URL '{{remUrlName}}' and all related availability data.
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default"
                            data-dismiss="modal">
                        Cancel
                    </button>
                    <button type="button" class="btn btn-primary"
                            ng-click="removeUrl(remUrlId)"
                            data-dismiss="modal">
                        Remove
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</div>
